#!/usr/bin/env bash
# -*- bash -*-
#
#
action="$1"
shift

set -u -e -o pipefail

BIN=/apps/bash_setup/bin
function git_is_clean {
    if ! git_repo_is_clean
    then
      echo -e "\n!!! GIT repo not clean enough.\n" 1>&2
      exit 1
    fi
}


case "$action" in

  "")
    cd $BIN && cd .. && git status
    ;;

  "bump")
    git_is_clean

    echo -e "=== Bumping from: $(bump current)\n"
    bump $1 --no-commit --no-bundle
    ;;

  "bump_and_commit_and_tag")
    bash_setup bump "$2"
    VER=$(cat VERSION)

    git_update
    git commit -m   "Bump: $VER"
    git tag         "v$VER"
    ;;

  "template")
    # inspired by:
    # http://stackoverflow.com/a/12422379
    file="$1"
    output="$2"

    if [[ -f $output ]]; then
      colorize yellow "=== Skipping existing file: $output"
      exit 0
    fi

    tmpl="$(cat "$1")"
    eval "echo \"$tmpl\"" >> "$output"
    colorize green "=== Wrote: $output"
    ;;

  *)
    echo "Unknown option: $action" 1>&2
    exit 1
    ;;

esac


